<div class="product-manager mt-3">
    <div class="operation">
        <p class="operation-title">Chức năng chính:</p>
        <div class="operation-btns">
            <button class="btn btn-success btn-lg" (click)=" formType='Create'">
                <i class=" bi bi-plus-circle"></i>
            </button>
            <button class="btn btn-primary px-4 py-2 ml-3">
                <i class="bi bi-funnel-fill"></i>
            </button>
        </div>
        <div *ngIf="formType === 'Create'" class="add-area mt-4">
            <form [formGroup]="productForm" (ngSubmit)="handleCreateProduct()">
                <h2 class="text-center" style="font-size: 1.8rem;">Thêm sản phẩm</h2>
                <div class="row mt-5">
                    <div class="col-12">
                        <label><strong>Tên sản phẩm:</strong> <span style="color: red;">*</span></label>
                        <input class="w-100 p-2" type="text" name="name" formControlName="name" minlength="1"
                            maxlength="250">
                        <div *ngIf="productForm.controls['name'].errors && isError" class="error-msg">
                            Tên sản phẩm phải từ 5 ký tự trở lên
                        </div>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-12">
                        <label><strong>Ảnh:</strong> <span style="color: red;">*</span></label>
                        <input class="w-100 p-2" type="text" name="name" formControlName="image" maxlength="250"
                            minlength="1" placeholder="Nhập đường dẫn">
                        <div *ngIf="productForm.controls['image'].errors && isError" class="error-msg">
                            Vui lòng nhập đường dẫn hình ảnh
                        </div>
                    </div>
                </div>
                <div class="row mt-3 align-items-center">
                    <div class="col-2">
                        <label><strong>Số lượng:</strong> <span style="color: red;">*</span></label>
                        <input class="w-100 p-2 mb-0 manager-input" type="number" name="quantity" min="1" max="1000"
                            maxlength="4" formControlName="quantity"
                            onKeyPress="if(this.value.length==4) return false;" />
                        <div *ngIf="productForm.controls['quantity'].errors && isError" class="error-msg">
                            Số lượng phải có ít nhất là 1
                        </div>
                    </div>
                    <div class="col-3">
                        <label><strong>Giá (đồng):</strong> <span style="color: red;">*</span></label>
                        <input class="w-100 p-2 mb-0 manager-input" type="number" min="500" max="2000000"
                            formControlName="price" onKeyPress="if(this.value.length==7) return false;" />
                        <div *ngIf="productForm.controls['price'].errors && isError" class="error-msg">
                            Giá ít nhất là 500 đồng
                        </div>
                    </div>
                    <div class="col-7 px-2">
                        <label for=""><strong>Loại:</strong> <span style="color: red;">*</span></label>
                        <div class="d-flex justify-content-end p-2">
                            <select name="" id="" class="form-control" formControlName="categories" style="width: 80%">
                                <option *ngFor="let category of categories" value="{{category._id}}">{{category.name}}
                                </option>
                            </select>
                        </div>
                        <div *ngIf="productForm.controls['categories'].errors && isError" class="error-msg">
                            Vui lòng chọn danh mục sản phẩm
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <label><strong>Mô tả:</strong></label>
                        <textarea class="w-100" type="text" name="name" id="" style="height: 100px;"
                            formControlName="description"></textarea>
                    </div>
                </div>
                <div class="row mt-3 justify-content-center">
                    <button class="btn btn-success px-4 py-3 mx-4" type="submit">Thêm</button>
                    <button class="btn btn-secondary px-4 py-3 mx-4" (click)="formType = ''">Đóng</button>
                </div>
            </form>
        </div>
        <!-- /*---------------------- Add Product --------------------------  */ -->
        <div *ngIf="formType === 'Edit'" class="add-area mt-4">
            <form [formGroup]="productForm" (ngSubmit)="updateProduct()">
                <h2 class="text-center" style="font-size: 1.8rem;">Sửa sản phẩm</h2>
                <div class="row mt-5">
                    <div class="col-12">
                        <label><strong>Mã sản phẩm:</strong> <span style="color: red;">*</span></label>
                        <input class="w-100 p-2" type="text" value="" style="color: #aaa;" readonly
                            formControlName="_id">
                    </div>
                    <div class=" col-12">
                        <label><strong>Tên sản phẩm:</strong> <span style="color: red;">*</span></label>
                        <input class="w-100 p-2" type="text" name="name" formControlName="name" id="name" minlength="1"
                            maxlength="250">
                        <div *ngIf="productForm.controls['name'].errors && isError" class="error-msg">
                            Tên sản phẩm phải từ 5 ký tự trở lên
                        </div>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-12">
                        <label><strong>Ảnh:</strong> <span style="color: red;">*</span></label>
                        <input class="w-100 p-2" type="text" name="name" formControlName="image"
                            placeholder="Nhập đường dẫn" minlength="1" maxlength="250">
                        <div *ngIf="productForm.controls['image'].errors && isError" class="error-msg">
                            Vui lòng nhập đường dẫn hình ảnh
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-2">
                        <label><strong>Số lượng:</strong> <span style="color: red;">*</span></label>
                        <input class="w-100 p-2 mb-0 manager-input" type="number" name="quantity"
                            formControlName="quantity" onKeyPress="if(this.value.length==4) return false;">
                        <div *ngIf="productForm.controls['quantity'].errors && isError" class="error-msg">
                            Số lượng phải có ít nhất là 1
                        </div>
                    </div>
                    <div class="col-3">
                        <label><strong>Giá (đồng):</strong> <span style="color: red;">*</span></label>
                        <input class="w-100 p-2 mb-0 manager-input" type="number" name="price" formControlName="price"
                            onKeyPress="if(this.value.length==7) return false;">
                        <div *ngIf="productForm.controls['price'].errors && isError" class="error-msg">
                            Giá ít nhất là 500 đồng
                        </div>
                    </div>
                    <div class="col-7 px-2">
                        <label for=""><strong>Loại:</strong> <span style="color: red;">*</span></label>
                        <div class="d-flex justify-content-end p-2">
                            <select name="" id="" class="form-control" formControlName="categories" style="width: 80%">
                                <option *ngFor="let category of categories" value="{{category._id}}">{{category.name}}
                                </option>
                            </select>
                        </div>
                        <div *ngIf="productForm.controls['categories'].errors && isError" class="error-msg">
                            Vui lòng chọn danh mục sản phẩm
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <label><strong>Mô tả:</strong></label>
                        <textarea class="w-100" type="text" name="name" id="" style="height: 100px;"
                            formControlName="description"></textarea>
                    </div>
                </div>
                <div class="row mt-3 justify-content-center">
                    <button class="btn btn-success px-4 py-3 mx-4" type="submit">Lưu</button>
                    <button class="btn btn-secondary px-4 py-3 mx-4" (click)="formType = ''">Đóng</button>
                </div>
            </form>
        </div>
    </div>
    <table class="table table-bordered mt-5 text-center">
        <thead>
            <tr>
                <th scope="col">Mã</th>
                <th scope="col">Ảnh</th>
                <th scope="col">Tên</th>
                <th scope="col">Giá</th>
                <th scope="col">Số lượng</th>
                <th scope="col">Loại</th>
                <th scope="col" style="width: 500px;">Mô tả</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let item of products | paginate: { itemsPerPage: 5, currentPage: page }">
                <th scope="row">
                    <a routerLink="/products/{{item._id}}">{{item._id}}</a>
                </th>
                <td><img src="{{item.image}}" alt="Ảnh sản phẩm" style="width: 50px; height: 50px;"></td>
                <td>{{item.name}}</td>
                <td>{{item.price | currency: 'VND'}}</td>
                <td>{{item.quantity}}</td>
                <td>{{item.categories.name}}</td>
                <td>{{item.description}}</td>
                <td>
                    <button class="btn btn-warning" (click)="getProduct(item)">
                        <i class="bi bi-pencil-square"></i>
                    </button>
                    <button class="btn btn-danger ml-3" (nzOnConfirm)="deleteProduct(item)" nz-popconfirm
                        nzPopconfirmTitle="Xác nhận xóa?" nzOkText="OK" nzCancelText="Hủy">
                        <i class="bi bi-trash-fill"></i>
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="pagination justify-content-center">
        <pagination-controls (pageChange)="page = $event" previousLabel="Sau" nextLabel="Trước"></pagination-controls>
    </div>
</div>